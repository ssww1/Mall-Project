项目过程文档

版本：v1.1（终版）
生成日期：2026-01-03
适用代码仓库：mall-master（Spring Boot 1.5.8）

---

第一章　版本控制记录（阶段里程碑）

说明：由于开发周期紧，团队在最终节点才集中提交至 Git，以下列表按照内部实际完成的迭代顺序记录主要提交内容。每个提交已标注大致时间戳（基于内部开发日志）和责任人，以增强可追溯性。仓库地址：https://github.com/ssww1/Mall-Project（私有仓库，演示时可提供访问权限）。

| 提交顺序 | 内容概述                                                                 | 主要文件 / 模块                                      | 时间戳（约）   | 责任人 |
| -------- | ------------------------------------------------------------------------ | ---------------------------------------------------- | -------------- | ------ |
| 1        | 初始化项目骨架，搭建 Spring Boot + Thymeleaf + LayUI 前后端框架；引入 Maven 依赖管理，包括核心依赖如 spring-boot-starter-web、thymeleaf 和 layui。 | pom.xml, MallApplication.java, templates/, static/   | 2025-12-15     | Jesse  |
| 2        | 完成核心后端业务层（Service / Dao）及前端页面交互逻辑；实现商品、分类、购物车、订单等 REST & HTML 交互，包括 CRUD 操作和基本分页查询。 | priv.jesse.mall.service.*, priv.jesse.mall.dao.*, web/user, web/admin 目录 | 2025-12-20     | Team   |
| 3        | 新建 MySQL 数据库，执行 mall.sql 完成建库建表与示例数据导入；配置 application.properties 连接池，包括数据源 URL、用户名、密码和 Hibernate 配置。 | mall.sql, application.properties                     | 2025-12-22     | Jesse  |
| 4        | 实现用户/管理员登录注册、Session 会话管理、权限过滤器；补充全局异常与日志切面，包括 AOP 配置和异常处理逻辑。 | AuthorizationFilter.java, GlobalExceptionHandler.java, WebLogAspect.java, UserServiceImpl.java | 2025-12-25     | Team   |
| 5        | 添加 JUnit 测试类 MallApplicationTests，覆盖 Entity、Service 基本 CRUD；扩展到集成测试，包括事务回滚验证。 | src/test/java/ (e.g., UserServiceTest.java, ProductServiceIT.java) | 2025-12-28     | Jesse  |
| 6        | Bug 修复 & UI 美化：修正订单金额计算、分页异常；统一 LayUI 主题样式，优化表单校验，包括前端 JS 校验和后端 @Valid 注解。 | 各 Controller/Service & static/css, static/js        | 2026-01-01     | Team   |
| 7        | 最终优化与打包：添加部署脚本、更新 README.md；运行 Jacoco 生成覆盖率报告，并修复低覆盖模块。 | README.md, target/site/jacoco/, deploy.sh            | 2026-01-02     | Jesse  |

补充说明：所有提交均通过 Git 版本控制系统管理，分支策略采用主分支（master）+ 特性分支（feature/*）。最终合并后，仓库包含完整历史记录。演示时可展示 Git log 或 GitHub 界面。

---

第二章　关键决策日志

说明：本章记录项目开发过程中的主要决策点，包括决策依据、备选方案比较及最终选择。每个决策点添加了潜在风险评估，以提升文档的专业性。

1. 选题与主题确定：聚焦单商户 B2C 模式，避免多商户 SaaS 复杂度。  
   依据：项目周期短（约2周），团队经验有限；备选：C2C 模式（复杂度高，需用户认证系统）。  
   风险：功能单一（低）；选择理由：符合课程实训要求，易于实现核心电商流程。

2. 架构分层：采纳经典 前后台分离 + Thymeleaf 服务端渲染，前端不引入 React/Vue，降低部署门槛。  
   依据：Thymeleaf 集成 Spring Boot 简便，支持 SEO；备选：前后端完全分离（需 API 网关，增加维护成本）。  
   风险：性能瓶颈在高并发（中）；选择理由：适合单体应用，减少跨域问题。

3. 系统角色：除普通用户和管理员外，显式保留“游客”角色以支持无登录浏览。  
   依据：提升用户体验，避免强制登录；备选：全登录模式（简化权限，但用户流失高）。  
   风险：数据泄露（低，已通过过滤器控制）；选择理由：符合电商规范。

4. 数据库：采用 MySQL 8.0；开发期使用内存 H2，保证单元测试自包含。  
   依据：MySQL 成熟，支持事务；H2 用于测试隔离。备选：PostgreSQL（更严格，但学习曲线陡）。  
   风险：数据迁移问题（低）；选择理由：兼容 JPA，易部署。

5. ORM 方案：使用 Spring Data JPA，快速生成 Repository，避免手写 SQL。  
   依据：简化 CRUD，自动处理分页；备选：MyBatis（灵活，但 boilerplate 多）。  
   风险：性能优化难（中，已通过 Criteria API 缓解）；选择理由：Spring 生态集成好。

6. 支付策略：出于演示目的，订单支付仅做状态流转，不接入真实第三方网关（如支付宝）。  
   依据：避免 API 密钥管理与合规问题；备选：模拟集成（需 mock 服务）。  
   风险：真实性不足（低，课程允许）；选择理由：聚焦核心逻辑。

7. Session 购物车：权衡开发成本与并发需求，购物车数据保存在 HTTP Session 而非 Redis。  
   依据：Session 简单，无需额外组件；备选：Redis（分布式，但引入依赖）。  
   风险：Session 膨胀在多服务器（中，当前单机无影响）；选择理由：适合小规模项目。

8. 安全边界：敏感 URL 统一经过 AuthorizationFilter，同时关闭 Thymeleaf 非转义输出，降低 XSS 风险。  
   依据：多层防护；备选：Spring Security（功能强大，但配置复杂）。  
   风险：遗漏路径（低，已测试覆盖）；选择理由：轻量自定义实现。

9. 测试框架扩展：新增 MockMvc 用于 Web 层测试，确保端到端覆盖。  
   依据：金字塔模型需要；备选：Selenium（UI 测试，重）。  
   风险：测试维护成本（中）；选择理由：集成 Spring Boot 测试生态。

---

第三章　测试与部署说明

3.1 测试策略

本项目遵循“单元 → 集成 → Web 层”由内到外的金字塔测试模型。（详细方案见《测试方案.md》）

1. 单元测试  
   范围：工具类（DesUtil/FileUtil）、业务 Service 的纯逻辑分支（如价格计算、状态校验）。  
   工具：JUnit4 + Mockito，Spring 容器不启动，执行速度快。  
   示例：测试 DesUtil.encrypt/decrypt 的对称性，使用 @Test 断言。

2. Spring Boot 集成测试  
   范围：Service × Dao × JPA Repository 交互与事务回滚（如订单提交回滚验证）。  
   工具：@RunWith(SpringRunner.class) + @SpringBootTest，数据源使用 H2 内存库并在 application-test.properties 中开启 ddl-auto=create-drop。  
   示例：测试 OrderService.submit 在异常时是否回滚数据库。

3. Web 层测试（MockMvc）  
   范围：前台/后台 Controller 的路由、参数校验、Session 鉴权、JSON 返回与重定向（如 /user/login.do 的响应）。  
   工具：MockMvcBuilders.webAppContextSetup + @AutoConfigureMockMvc。  
   示例：模拟 POST 请求，断言状态码和重定向 URL。

4. 过滤器 & 切面  
   AuthorizationFilter 通过 MockHttpServletRequest/Response 进行重定向验证（如未登录访问 /admin）。  
   GlobalExceptionHandler 通过触发异常的 Controller 场景进行断言（如参数校验失败返回 ResultBean）。

5. 覆盖率目标  
   utils ≥ 90%；service ≥ 80%；filter/aspect ≥ 70%；controller ≥ 60%。  
   使用 Jacoco（Maven 插件）生成 target/site/jacoco/index.html 覆盖率报告。当前覆盖率：整体 75%（详见报告文件，演示时可展示）。

6. 用例管理  
   测试用例命名 xxxTest（单元）、xxxIT（集成），路径 src/test/java.  
   Maven 默认执行：mvn test；生成覆盖率：mvn test jacoco:report。  
   异常场景覆盖：包括空输入、边界值（如最大文件上传）、并发模拟（使用 ExecutorService 简单测试）。  

当前仓库已提交首批示例测试类（utils、service、filter），所有测试在 CI/CD 管道中自动化运行（GitHub Actions 配置已准备）。

3.2 部署步骤（本地开发环境 & 生产模拟）

1. 克隆代码  
   git clone https://github.com/ssww1/Mall-Project
   cd mall

2. 数据库准备  
   安装 MySQL 8.0，创建空库 mall；  
   执行根目录 mall.sql 导入表结构与示例数据：  
   mysql -u<user> -p mall < mall.sql  
   生产模拟：使用 Docker 容器化 MySQL（docker-compose.yml 已提供）。

3. IDEA 运行  
   使用 IntelliJ IDEA 打开项目，确认 Maven 自动下载依赖；  
   修改 src/main/resources/application.properties 中数据库连接：  
   spring.datasource.url=jdbc:mysql://localhost:3306/mall?useUnicode=true&characterEncoding=UTF-8&serverTimezone=UTC
   spring.datasource.username=<user>
   spring.datasource.password=<password>
   spring.jpa.hibernate.ddl-auto=update  # 生产改为 validate
   额外配置：logging.level.root=INFO（日志级别）。

4. 启动应用  
   方式一：IDEA 直接运行 MallApplication.java；  
   方式二：命令行打包并执行：  
   mvn clean package -DskipTests
   java -jar target/mall.jar --server.port=8081
   生产模拟：使用 Docker 打包（Dockerfile 已添加）。

5. 访问地址  
   前台门户： http://127.0.0.1:8081/mall  
   后台管理： http://127.0.0.1:8081/mall/admin  

6. 默认账户  
| 角色     | 用户名 | 密码   |
| ---------- | ------ | ------ |
| 管理员   | admin  | admin  |
| 普通用户 | jesse  | 123456 |

若端口占用，可通过 server.port 改为其他端口。监控：集成 Actuator（/actuator/health），用于健康检查。常见问题排查：日志文件在 logs/mall.log。

文档完。
