商城系统需求文档（基于 mall 源码）

文档版本：v1.1（终版）
生成日期：2026-01-03
适用代码仓库：mall-master（Spring Boot 1.5.8）

本需求文档完全依据实际源码结构、实体模型及控制器路由编写，确保所述范围与实现一致。

1. 项目概述
商城系统提供一个 B2C 单商户电子商务解决方案，包含前台商城与后台运营两大子系统。系统采用 JPA + Thymeleaf 的 MVC 单体架构，支持商品浏览、购物车、下单支付、订单跟踪以及后台的 CRUD 运维能力。
关键特性：
- 支持游客浏览，提升用户转化率。
- 集成基本安全过滤器和异常处理，确保系统鲁棒性。
- 基于 Spring Boot 快速部署，适用于中小企业电商起步。

2. 需求分析
2.1 业务背景与目标
当下中小企业快速进入电商渠道的诉求强烈，但市面 SaaS 平台收费高且定制化受限；本系统旨在提供一套开源、自部署的 B2C 电商骨架，帮助企业快速构建线上商城。
核心目标：
1. 用户可在 5 分钟内完成注册并成功下单；
2. 运营人员可在 3 步之内完成商品上架；
3. 系统单机支持 ≥200 并发浏览、≥20 并发下单（基于 JMeter 测试模拟）。
4. 确保 95% 以上核心路径覆盖单元/集成测试。

2.2 业务流程概览
- 用户购物流程：首页浏览 → 分类/搜索商品 → 查看详情 → 添加购物车 → 提交订单 → 模拟支付 → 订单跟踪/确认收货。
- 管理员运营流程：登录后台 → 商品/分类管理（CRUD） → 订单处理（查看/发货） → 用户维护。
- 系统通用流程：注册/登录（Session 管理） → 异常处理（统一返回） → 日志记录（AOP）。

2.3 约束与假设
- 仅支持单商户模式，不区分店铺；
- 支付、物流为模拟流程（状态机驱动）；
- 系统部署于内网，无公网文件上传风险；
- 假设用户环境：JDK 8+、MySQL 8.0、浏览器 Chrome/Edge。

2.4 风险与缓解
| 风险           | 等级 | 缓解措施                                      |
| ---------------- | ------ | ---------------------------------------------- |
| 高并发秒杀     | 中   | Redis + 队列预留扩展位（当前未实现，未来迭代） |
| SQL 注入       | 高   | JPA 预编译、输入校验（@Valid + Criteria API）  |
| 文件上传滥用   | 低   | 大小 & 扩展名限制（FileUtil 检查 ≤2MB、特定后缀） |
| Session 劫持   | 中   | HTTPS 预留、短失效时间（30min）                |
| 数据一致性丢失 | 高   | @Transactional 包裹业务逻辑                    |

3. 系统角色
1. 游客：未登录状态浏览商品、查看首页与分类页（无需 Session）。
2. 普通用户：注册/登录后可执行购物车、下单、支付、查看订单、确认收货等操作（Session 键："user"）。
3. 后台管理员：登录后台后进行商品、分类、订单、用户的维护与运营（Session 键："login_user"）。

4. 功能范围
商城系统整体功能归纳为前台商城门户与后台运营管理两大子系统。

4.1 前台功能 (priv.jesse.mall.web.user)
| 功能           | 详细说明                                      | 入口 / 接口                              | 输入示例                     | 输出示例                     |
| ---------------- | ---------------------------------------------- | ---------------------------------------- | ---------------------------- | ---------------------------- |
| 首页           | 首页静态内容展示、热门商品和最新商品组件       | IndexController → /index.html            | 无                           | Thymeleaf 渲染首页模板       |
| 用户注册       | 输入用户名、密码、联系方式，唯一性校验         | /user/toRegister.html; /user/register.do  | username="jesse", password="123456" | 重定向首页，Session 保存 user |
| 用户登录       | 表单登录，成功后 Session 保存 user             | /user/toLogin.html & /user/login.do      | username="jesse", password="123456" | 重定向首页或原页面           |
| 用户登出       | 清理 Session 并重定向首页                      | /user/logout.do                          | 无                           | 重定向 /index.html           |
| 用户名检查     | AJAX 检测用户名是否存在                        | /user/checkUsername.do                   | username="jesse"             | ResultBean<Boolean>          |
| 商品详情       | 根据商品 ID 展示详情页                         | /product/get.html?id=                    | id=1                         | Thymeleaf 渲染 product.html  |
| 商品查询 – 热门| 查询 isHot=1 商品集合                          | /product/hot.do                          | 无                           | List<Product> JSON           |
| 商品查询 – 最新| 分页获取最新上架商品                           | /product/new.do?pageNo=&pageSize=        | pageNo=1, pageSize=10         | Page<Product>                |
| 分类浏览       | 根据一级或二级分类分页浏览商品                 | /product/category.do、/product/categorySec.do | cid=1, pageNo=1              | Page<Product>                |
| 二级分类列表   | 根据一级分类获取所有二级分类                   | /product/getCategorySec.do               | cid=1                        | List<Classification> JSON    |
| 购物车 – 添加  | 将商品加入购物车（存 Session）                 | /product/addCart.do                      | pid=1, count=2               | ResultBean "添加成功"        |
| 购物车 – 移除  | 从购物车删除商品                               | /product/delCart.do                      | pid=1                        | ResultBean "删除成功"        |
| 购物车 – 查看  | 返回 Session 中购物车条目                      | /product/listCart.do                     | 无                           | List<CartItem> JSON          |
| 下单提交       | 依据购物车生成订单（含收货人信息）             | /order/submit.do                         | address="某地址"             | 重定向订单列表               |
| 订单列表       | 展示当前登录用户所有订单                       | /order/toList.html & /order/list.do      | 无                           | List<Order>                  |
| 订单详情       | 查询指定订单的订单项                           | /order/getDetail.do                      | oid=1                        | List<OrderItem> JSON         |
| 订单支付       | 修改状态为已支付                               | /order/pay.do                            | oid=1                        | ResultBean "支付成功"        |
| 订单收货       | 用户确认收货，状态流转至已完成                 | /order/receive.do                        | oid=1                        | ResultBean "收货成功"        |

4.2 后台功能 (priv.jesse.mall.web.admin)
| 功能           | 详细说明                                      | 入口 / 接口                              |
| ---------------- | ---------------------------------------------- | ---------------------------------------- |
| 管理员登录     | 表单登录、Session 保存 login_user              | /admin/toLogin.html & /admin/login.do    |
| 首页仪表盘     | 后台首页静态模板                               | /admin/toIndex.html                      |
| 用户管理       | 分页查询、编辑、删除用户                       | AdminUserController 多接口               |
| 商品管理       | 添加、编辑(含图片上传)、删除、分页查询商品     | AdminProductController 多接口            |
| 商品图片下载   | 访问 file/ 目录                                | /admin/product/img/{filename}            |
| 分类管理       | 一级、二级分类增删改查与分页                   | AdminClassificationController 多接口     |
| 订单管理       | 分页查询订单、查看明细、发货                   | AdminOrderController 多接口              |

4.3 通用与系统功能
| 组件               | 作用说明                                      |
| -------------------- | ---------------------------------------------- |
| ResultBean<T>      | 前后端通信包装类                              |
| AOP 日志           | 请求/响应日志切面 (WebLogAspect)              |
| 全局异常处理       | 捕获业务异常并跳转 error.html                 |
| 登录过滤器         | 拦截敏感 URI，校验 Session                    |
| DES 加密工具       | 用户密码加密存储 (DesUtil)                    |
| 文件存储工具       | 保存上传商品图片到 file/ 目录 (FileUtil)      |

5. 实体与状态
5.1 主要实体
| 实体           | 字段摘要                                      |
| ---------------- | ---------------------------------------------- |
| User             | id, username, password, name, phone, email, addr |
| Product          | id, title, marketPrice, shopPrice, image, desc, isHot, csid, pdate |
| Classification   | id, parentId, cname, type(1 一级/2 二级)       |
| Order            | id, uid, total, state (0-3), address, createTime |
| OrderItem        | id, pid, oid, count, subtotal                 |
| AdminUser        | id, username, password                        |

5.2 订单状态流转
0 待付款 → 1 已付款（pay.do）→ 2 已发货（后台 send.do）→ 3 已完成（用户 receive.do）。状态变更使用 @Transactional 确保原子性。

6. 页面/模板结构
前台模板位于 src/main/resources/templates/mall，后台位于 templates/admin。
- 公共模板：error.html、layout.html
- 前台示例：index.html、product.html、cart.html
- 后台示例：admin/index.html、admin/product/list.html

7. 非功能需求
- 会话管理：HTTP Session，失效时间 30 分钟。
- 上传限制：单文件 ≤ 2 MB，存储根目录 /file（MD5 重命名）。
- 浏览器兼容：Chrome/Edge 最新版；移动端适配（LayUI 响应式）。
- 并发性能：单实例支持 200 并发用户浏览、20 并发下单。
- 可访问性：遵循 WCAG 基本原则（如 alt 属性）。
- 国际化：预留 i18n 支持（当前中文为主）。

8. 鲁棒性设计与风险控制（略去部分重复代码片段，保持与你项目一致）

文档完。
